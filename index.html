<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPECTRE | OSINT Intelligence Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
:root {
    --bg-void: #08090a;
    --bg-primary: #0d0e10;
    --bg-secondary: #131517;
    --bg-tertiary: #1a1c1f;
    --bg-card: #1e2023;
    --bg-elevated: #252729;
    --bg-hover: #2d3033;
    --border-subtle: #232629;
    --border-default: #32363a;
    --border-emphasis: #45494f;
    --border-active: #3b82f6;
    --text-primary: #f0f2f4;
    --text-secondary: #9ca3af;
    --text-muted: #6b7280;
    --text-subtle: #4b5563;
    --accent-primary: #3b82f6;
    --accent-secondary: #8b5cf6;
    --accent-green: #10b981;
    --accent-amber: #f59e0b;
    --accent-red: #ef4444;
    --accent-cyan: #06b6d4;
    --glow-primary: rgba(59, 130, 246, 0.12);
    --glow-green: rgba(16, 185, 129, 0.12);
    --gradient-primary: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
    --gradient-glow: radial-gradient(ellipse at center, rgba(59,130,246,0.08) 0%, transparent 70%);
    --shadow-md: 0 4px 20px rgba(0,0,0,0.4);
    --shadow-lg: 0 8px 40px rgba(0,0,0,0.5);
    --font-display: 'Space Grotesk', sans-serif;
    --font-mono: 'JetBrains Mono', monospace;
}
[data-theme="light"] {
    --bg-void: #f8fafc; --bg-primary: #ffffff; --bg-secondary: #f1f5f9;
    --bg-tertiary: #e2e8f0; --bg-card: #ffffff; --bg-elevated: #ffffff;
    --bg-hover: #f1f5f9; --border-subtle: #e2e8f0; --border-default: #cbd5e1;
    --border-emphasis: #94a3b8; --text-primary: #0f172a; --text-secondary: #475569;
    --text-muted: #64748b; --accent-primary: #2563eb; --glow-primary: rgba(37,99,235,0.1);
    --shadow-md: 0 4px 20px rgba(0,0,0,0.08); --shadow-lg: 0 8px 40px rgba(0,0,0,0.1);
}
[data-theme="hacker"] {
    --bg-void: #000000; --bg-primary: #050505; --bg-secondary: #0a0a0a;
    --bg-tertiary: #0f0f0f; --bg-card: #111111; --bg-elevated: #161616;
    --border-subtle: #0d1f0d; --border-default: #1a3d1a; --border-active: #22c55e;
    --text-primary: #22c55e; --text-secondary: #16a34a; --text-muted: #15803d;
    --accent-primary: #22c55e; --accent-secondary: #4ade80; --glow-primary: rgba(34,197,94,0.15);
    --gradient-primary: linear-gradient(135deg, #22c55e 0%, #4ade80 100%);
}
* { margin: 0; padding: 0; box-sizing: border-box; }
html { height: 100%; }
body {
    font-family: var(--font-display);
    background: var(--bg-void);
    color: var(--text-primary);
    min-height: 100vh;
    transition: background 0.3s, color 0.3s;
    font-size: 14px;
}
body.results-mode { overflow: hidden; height: 100vh; }
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: var(--bg-primary); }
::-webkit-scrollbar-thumb { background: var(--border-default); border-radius: 4px; }
.hidden { display: none !important; }

/* Landing Page */
.landing-page {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    background: var(--bg-void);
    position: relative;
    overflow: hidden;
}
.landing-page::before {
    content: '';
    position: absolute;
    top: 0; left: 50%; transform: translateX(-50%);
    width: 100%; max-width: 1200px; height: 70vh;
    background: var(--gradient-glow);
    pointer-events: none;
}
.landing-page.fade-out { opacity: 0; transform: scale(0.98); transition: all 0.3s; }
.landing-header {
    display: flex;
    justify-content: flex-end;
    padding: 1rem 2rem;
    gap: 1rem;
    position: relative;
    z-index: 10;
}
.header-link {
    font-size: 0.85rem;
    color: var(--text-muted);
    text-decoration: none;
    padding: 0.5rem 0.75rem;
    border-radius: 6px;
    transition: all 0.2s;
}
.header-link:hover { background: var(--bg-tertiary); color: var(--text-primary); }
.landing-main {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    position: relative;
    z-index: 10;
    margin-top: -80px;
}
.logo-container { margin-bottom: 3rem; text-align: center; }
.logo-icon {
    width: 88px; height: 88px;
    margin: 0 auto 1.5rem;
    background: var(--gradient-primary);
    border-radius: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.25rem;
    box-shadow: var(--shadow-lg), 0 0 60px rgba(59,130,246,0.2);
    animation: float 5s ease-in-out infinite;
}
@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}
.logo-text {
    font-size: 3.5rem;
    font-weight: 700;
    letter-spacing: 10px;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}
.logo-tagline {
    font-size: 0.95rem;
    color: var(--text-muted);
    margin-top: 0.5rem;
    letter-spacing: 3px;
    text-transform: uppercase;
}

/* Search Container */
.search-container { width: 100%; max-width: 640px; margin-bottom: 1.5rem; }
.search-box {
    display: flex;
    align-items: center;
    background: var(--bg-secondary);
    border: 1px solid var(--border-default);
    border-radius: 28px;
    padding: 0.5rem 1.25rem;
    transition: all 0.25s;
    box-shadow: var(--shadow-md);
}
.search-box:hover { box-shadow: var(--shadow-lg); border-color: var(--border-emphasis); }
.search-box:focus-within {
    border-color: var(--accent-primary);
    box-shadow: 0 0 0 4px var(--glow-primary), var(--shadow-lg);
}
.search-icon { font-size: 1.2rem; color: var(--text-muted); margin-right: 0.75rem; }
.search-input {
    flex: 1;
    background: transparent;
    border: none;
    font-size: 1rem;
    color: var(--text-primary);
    padding: 0.85rem 0;
    outline: none;
    font-family: var(--font-display);
}
.search-input::placeholder { color: var(--text-subtle); }

/* Quick Inputs */
.quick-fields {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    justify-content: center;
    margin-bottom: 1.5rem;
    max-width: 700px;
}
.quick-field {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-subtle);
    border-radius: 20px;
    padding: 0.4rem 0.85rem;
    transition: all 0.2s;
}
.quick-field:focus-within { border-color: var(--accent-primary); background: var(--bg-secondary); }
.quick-field.has-value { border-color: var(--accent-green); }
.quick-field label {
    font-size: 0.65rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 500;
}
.quick-field input {
    background: transparent;
    border: none;
    color: var(--text-primary);
    font-size: 0.85rem;
    width: 90px;
    outline: none;
    font-family: var(--font-mono);
}
.quick-field input::placeholder { color: var(--text-subtle); }
.quick-field input.w-sm { width: 55px; }
.quick-field input.w-lg { width: 130px; }

/* Buttons */
.btn {
    font-family: var(--font-display);
    font-size: 0.875rem;
    font-weight: 500;
    padding: 0.7rem 1.5rem;
    border-radius: 8px;
    border: 1px solid var(--border-default);
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.15s;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}
.btn:hover { background: var(--bg-hover); border-color: var(--border-emphasis); color: var(--text-primary); }
.btn:active { transform: scale(0.98); }
.btn-primary {
    background: var(--gradient-primary);
    border: none;
    color: white;
    font-weight: 600;
    padding: 0.8rem 2.5rem;
}
.btn-primary:hover { opacity: 0.9; box-shadow: var(--shadow-md); color: white; }
.btn-sm { font-size: 0.75rem; padding: 0.45rem 0.85rem; }
.btn-xs { font-size: 0.65rem; padding: 0.3rem 0.6rem; }
.btn-icon { padding: 0.5rem; min-width: 36px; justify-content: center; }
.btn-ghost { background: transparent; border-color: transparent; }
.search-buttons { display: flex; gap: 0.75rem; justify-content: center; margin-bottom: 1.5rem; }

/* Advanced Toggle */
.advanced-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-muted);
    font-size: 0.85rem;
    cursor: pointer;
    padding: 0.5rem 1rem;
    margin-bottom: 1rem;
    transition: color 0.2s;
}
.advanced-toggle:hover { color: var(--text-primary); }
.advanced-toggle svg { transition: transform 0.3s; }
.advanced-toggle.open svg { transform: rotate(180deg); }

/* Advanced Options Panel */
.advanced-panel {
    max-width: 780px;
    width: 100%;
    background: var(--bg-secondary);
    border: 1px solid var(--border-subtle);
    border-radius: 16px;
    max-height: 0;
    overflow: hidden;
    transition: all 0.35s ease;
    margin-bottom: 1.5rem;
}
.advanced-panel.open { padding: 1.5rem; max-height: 400px; }
.advanced-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
    gap: 1rem;
}
.adv-input { display: flex; flex-direction: column; gap: 0.35rem; }
.adv-input label {
    font-size: 0.65rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
.adv-input input {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-subtle);
    border-radius: 8px;
    padding: 0.6rem 0.75rem;
    color: var(--text-primary);
    font-size: 0.85rem;
    font-family: var(--font-mono);
    transition: all 0.2s;
}
.adv-input input:focus { outline: none; border-color: var(--accent-primary); box-shadow: 0 0 0 3px var(--glow-primary); }
.adv-input input::placeholder { color: var(--text-subtle); }

/* Category Pills */
.category-pills {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    justify-content: center;
    max-width: 680px;
    margin-bottom: 2rem;
}
.cat-pill {
    font-size: 0.75rem;
    padding: 0.4rem 0.9rem;
    border-radius: 20px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-subtle);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
}
.cat-pill:hover { background: var(--bg-hover); border-color: var(--border-default); color: var(--text-primary); }
.cat-pill.active { background: var(--glow-primary); border-color: var(--accent-primary); color: var(--accent-primary); }

/* Landing Footer */
.landing-footer {
    padding: 1rem 2rem;
    border-top: 1px solid var(--border-subtle);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
    position: relative;
    z-index: 10;
}
.footer-section { display: flex; gap: 1.5rem; align-items: center; }
.footer-link { font-size: 0.8rem; color: var(--text-muted); text-decoration: none; transition: color 0.2s; }
.footer-link:hover { color: var(--text-primary); }
.tool-count {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: var(--text-muted);
}
.tool-count strong { color: var(--accent-primary); }

/* Select */
.select {
    font-family: var(--font-display);
    font-size: 0.8rem;
    padding: 0.45rem 1.75rem 0.45rem 0.7rem;
    border-radius: 6px;
    border: 1px solid var(--border-default);
    background: var(--bg-tertiary);
    color: var(--text-primary);
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10'%3E%3Cpath fill='%236b7280' d='M0 3l5 5 5-5z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.6rem center;
}
.select:focus { outline: none; border-color: var(--accent-primary); }

/* ============================================
   RESULTS PAGE STYLES
   ============================================ */
.results-page {
    display: none;
    flex-direction: column;
    height: 100vh;
    opacity: 0;
    transition: opacity 0.3s;
}
.results-page.active { display: flex; opacity: 1; }

.results-header {
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-subtle);
    padding: 0.6rem 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-shrink: 0;
    z-index: 100;
}
.results-logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    text-decoration: none;
    flex-shrink: 0;
}
.results-logo-icon {
    width: 34px; height: 34px;
    background: var(--gradient-primary);
    border-radius: 9px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.95rem;
}
.results-logo-text {
    font-size: 1rem;
    font-weight: 700;
    letter-spacing: 2px;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}
.results-inputs {
    flex: 1;
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    align-items: center;
}
.input-pill {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-subtle);
    border-radius: 6px;
    padding: 0.3rem 0.5rem;
    transition: all 0.15s;
}
.input-pill:focus-within { border-color: var(--accent-primary); box-shadow: 0 0 0 2px var(--glow-primary); }
.input-pill.has-value { border-color: var(--accent-green); }
.input-pill label {
    font-size: 0.55rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.3px;
}
.input-pill input {
    background: transparent;
    border: none;
    color: var(--text-primary);
    font-family: var(--font-mono);
    font-size: 0.75rem;
    width: 75px;
    outline: none;
}
.input-pill input::placeholder { color: var(--text-subtle); }
.input-pill input.w-sm { width: 45px; }
.input-pill input.w-lg { width: 110px; }
.input-pill input.w-xl { width: 140px; }
.header-actions { display: flex; align-items: center; gap: 0.4rem; flex-shrink: 0; }

/* Extended Inputs */
.extended-bar {
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-subtle);
    padding: 0.5rem 1rem;
    display: none;
    flex-wrap: wrap;
    gap: 0.4rem;
    align-items: center;
}
.extended-bar.visible { display: flex; }

/* Controls Bar */
.controls-bar {
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-subtle);
    padding: 0.45rem 1rem;
    display: flex;
    align-items: center;
    gap: 0.6rem;
    flex-wrap: wrap;
    flex-shrink: 0;
}
.controls-section { display: flex; align-items: center; gap: 0.35rem; }
.divider { width: 1px; height: 18px; background: var(--border-subtle); }
.filter-search { position: relative; }
.filter-search input {
    width: 180px;
    padding: 0.4rem 0.7rem 0.4rem 1.8rem;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-subtle);
    border-radius: 6px;
    color: var(--text-primary);
    font-size: 0.75rem;
    outline: none;
}
.filter-search input:focus { border-color: var(--accent-primary); }
.filter-search::before {
    content: 'üîç';
    position: absolute;
    left: 0.55rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.6rem;
    opacity: 0.5;
}

/* Stats Bar */
.stats-bar {
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-subtle);
    padding: 0.4rem 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 0.75rem;
    flex-shrink: 0;
}
.stat-group { display: flex; align-items: center; gap: 1.25rem; }
.stat { display: flex; align-items: baseline; gap: 0.3rem; }
.stat-value {
    font-family: var(--font-mono);
    font-size: 1.05rem;
    font-weight: 600;
    color: var(--accent-cyan);
}
.stat-label { font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; }
.progress-bar { width: 90px; height: 5px; background: var(--bg-tertiary); border-radius: 3px; overflow: hidden; }
.progress-fill { height: 100%; background: var(--gradient-primary); transition: width 0.3s; }
.filter-pills { display: flex; gap: 0.25rem; flex-wrap: wrap; }
.filter-pill {
    font-family: var(--font-mono);
    font-size: 0.6rem;
    padding: 0.25rem 0.6rem;
    border-radius: 20px;
    border: 1px solid var(--border-subtle);
    background: transparent;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.15s;
}
.filter-pill:hover { border-color: var(--border-default); color: var(--text-secondary); }
.filter-pill.active { border-color: var(--accent-primary); background: var(--glow-primary); color: var(--accent-primary); }

/* Main Layout */
.main-wrapper { display: flex; flex: 1; overflow: hidden; }
.sidebar {
    width: 260px;
    background: var(--bg-secondary);
    border-right: 1px solid var(--border-subtle);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
    transition: width 0.25s, margin 0.25s;
}
.sidebar.collapsed { width: 0; margin-left: -1px; overflow: hidden; }
.sidebar-tabs { display: flex; border-bottom: 1px solid var(--border-subtle); }
.sidebar-tab {
    flex: 1;
    padding: 0.6rem 0.4rem;
    text-align: center;
    font-size: 0.65rem;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.15s;
    border-bottom: 2px solid transparent;
}
.sidebar-tab:hover { color: var(--text-secondary); background: var(--bg-tertiary); }
.sidebar-tab.active { color: var(--accent-primary); border-bottom-color: var(--accent-primary); }
.sidebar-content { flex: 1; overflow-y: auto; padding: 0.75rem; }
.sidebar-section { margin-bottom: 1rem; }
.sidebar-title {
    font-size: 0.65rem;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.history-item, .fav-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.45rem 0.5rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.75rem;
    color: var(--text-secondary);
    transition: all 0.15s;
    margin-bottom: 0.2rem;
}
.history-item:hover, .fav-item:hover { background: var(--bg-tertiary); color: var(--text-primary); }
.history-text { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.history-time { font-size: 0.55rem; color: var(--text-subtle); }

/* Main Content */
.main-content { flex: 1; overflow-y: auto; padding: 1rem; background: var(--bg-primary); }
.results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1rem;
}
.results-grid.cols-2 { grid-template-columns: repeat(2, 1fr); }
.results-grid.cols-3 { grid-template-columns: repeat(3, 1fr); }

/* Category Card */
.category-card {
    background: var(--bg-card);
    border: 1px solid var(--border-subtle);
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.2s;
}
.category-card.has-results { border-color: var(--border-default); }
.category-card:hover { border-color: var(--border-emphasis); }
.category-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.7rem 1rem;
    background: var(--bg-tertiary);
    cursor: pointer;
    user-select: none;
}
.category-header:hover { background: var(--bg-hover); }
.category-title { display: flex; align-items: center; gap: 0.5rem; }
.category-icon { font-size: 1.05rem; }
.category-name { font-weight: 600; font-size: 0.85rem; }
.category-count {
    font-family: var(--font-mono);
    font-size: 0.6rem;
    color: var(--text-muted);
    background: var(--bg-elevated);
    padding: 0.15rem 0.5rem;
    border-radius: 10px;
}
.category-count.active { background: var(--glow-primary); color: var(--accent-primary); }
.category-toggle { font-size: 0.7rem; color: var(--text-muted); transition: transform 0.2s; }
.category-card.collapsed .category-toggle { transform: rotate(-90deg); }
.tool-list { max-height: 380px; overflow-y: auto; }
.category-card.collapsed .tool-list { display: none; }
.tool-item {
    display: flex;
    align-items: center;
    padding: 0.55rem 1rem;
    border-bottom: 1px solid var(--border-subtle);
    gap: 0.5rem;
    transition: background 0.15s;
}
.tool-item:last-child { border-bottom: none; }
.tool-item:hover { background: var(--bg-tertiary); }
.tool-item.inactive { opacity: 0.35; }
.tool-checkbox {
    width: 16px; height: 16px;
    border: 2px solid var(--border-default);
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.6rem;
    transition: all 0.15s;
    flex-shrink: 0;
}
.tool-checkbox:hover { border-color: var(--accent-primary); }
.tool-checkbox.checked { background: var(--accent-green); border-color: var(--accent-green); color: white; }
.tool-info { flex: 1; min-width: 0; }
.tool-name {
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--text-primary);
    text-decoration: none;
    display: block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.tool-name:hover { color: var(--accent-primary); }
.tool-desc { font-size: 0.65rem; color: var(--text-muted); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.tool-badges { display: flex; gap: 0.25rem; flex-shrink: 0; }
.badge {
    font-family: var(--font-mono);
    font-size: 0.5rem;
    padding: 0.15rem 0.4rem;
    border-radius: 4px;
    text-transform: uppercase;
    font-weight: 600;
}
.badge-free { background: rgba(16,185,129,0.15); color: var(--accent-green); }
.badge-freemium { background: rgba(245,158,11,0.15); color: var(--accent-amber); }
.badge-paid { background: rgba(239,68,68,0.15); color: var(--accent-red); }
.badge-cli { background: rgba(139,92,246,0.15); color: var(--accent-secondary); }
.tool-actions { display: flex; gap: 0.2rem; opacity: 0; transition: opacity 0.15s; }
.tool-item:hover .tool-actions { opacity: 1; }
.tool-action {
    width: 22px; height: 22px;
    border: none;
    background: var(--bg-elevated);
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.65rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
}
.tool-action:hover { background: var(--bg-hover); }
.tool-action.favorited { color: var(--accent-amber); }

/* Empty State */
.empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 4rem 2rem;
    text-align: center;
}
.empty-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.4; }
.empty-title { font-size: 1.25rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem; }
.empty-text { font-size: 0.85rem; color: var(--text-muted); max-width: 350px; }

/* Dropdown */
.dropdown { position: relative; }
.dropdown-menu {
    position: absolute;
    top: calc(100% + 4px);
    left: 0;
    background: var(--bg-elevated);
    border: 1px solid var(--border-default);
    border-radius: 8px;
    padding: 0.4rem;
    min-width: 170px;
    z-index: 1000;
    display: none;
    box-shadow: var(--shadow-lg);
}
.dropdown-menu.right { left: auto; right: 0; }
.dropdown.open .dropdown-menu { display: block; }
.dropdown-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.7rem;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.75rem;
    transition: all 0.1s;
}
.dropdown-item:hover { background: var(--bg-tertiary); }
.dropdown-divider { height: 1px; background: var(--border-subtle); margin: 0.4rem 0; }
.dropdown-header { font-size: 0.55rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; padding: 0.3rem 0.7rem; }

/* Toast */
.toast-container {
    position: fixed;
    bottom: 1rem;
    right: 1rem;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}
.toast {
    background: var(--bg-elevated);
    border: 1px solid var(--border-default);
    border-radius: 8px;
    padding: 0.7rem 1rem;
    font-size: 0.8rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    animation: slideIn 0.2s ease;
    box-shadow: var(--shadow-lg);
}
.toast.success { border-left: 4px solid var(--accent-green); }
.toast.error { border-left: 4px solid var(--accent-red); }
.toast.info { border-left: 4px solid var(--accent-primary); }
@keyframes slideIn {
    from { opacity: 0; transform: translateX(100px); }
    to { opacity: 1; transform: translateX(0); }
}

/* Modal */
.modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
}
.modal-backdrop.open { opacity: 1; pointer-events: auto; }
.modal {
    background: var(--bg-secondary);
    border: 1px solid var(--border-default);
    border-radius: 14px;
    width: 90%;
    max-width: 480px;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    box-shadow: var(--shadow-lg);
    transform: scale(0.95);
    transition: transform 0.2s;
}
.modal-backdrop.open .modal { transform: scale(1); }
.modal-header {
    padding: 1rem 1.25rem;
    border-bottom: 1px solid var(--border-subtle);
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.modal-title { font-weight: 600; font-size: 1rem; }
.modal-close {
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: 1.25rem;
    cursor: pointer;
    padding: 0.25rem;
}
.modal-close:hover { color: var(--text-primary); }
.modal-body { padding: 1.25rem; overflow-y: auto; }
.modal-footer {
    padding: 1rem 1.25rem;
    border-top: 1px solid var(--border-subtle);
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
}
.form-group { margin-bottom: 1rem; }
.form-label { display: block; font-size: 0.75rem; font-weight: 500; color: var(--text-secondary); margin-bottom: 0.35rem; }
.form-input {
    width: 100%;
    padding: 0.6rem 0.75rem;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-subtle);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 0.85rem;
    transition: all 0.15s;
}
.form-input:focus { outline: none; border-color: var(--accent-primary); box-shadow: 0 0 0 3px var(--glow-primary); }

/* Responsive */
@media (max-width: 768px) {
    .logo-text { font-size: 2.5rem; letter-spacing: 5px; }
    .logo-icon { width: 68px; height: 68px; }
    .quick-fields { flex-direction: column; align-items: stretch; }
    .quick-field { justify-content: center; }
    .advanced-grid { grid-template-columns: 1fr 1fr; }
    .sidebar { position: fixed; left: 0; top: 0; bottom: 0; z-index: 200; transform: translateX(-100%); }
    .sidebar.open { transform: translateX(0); }
    .results-grid { grid-template-columns: 1fr; }
    .results-inputs { display: none; }
}
</style>
</head>
<body>
<!-- Landing Page -->
<div class="landing-page" id="landingPage">
    <header class="landing-header">
        <a href="#" class="header-link" onclick="showAboutModal(); return false;">About</a>
        <a href="#" class="header-link" onclick="showSettingsModal(); return false;">Settings</a>
        <select class="select" id="themeSelectLanding" onchange="setTheme(this.value)">
            <option value="dark">üåô Dark</option>
            <option value="light">‚òÄÔ∏è Light</option>
            <option value="hacker">üíª Hacker</option>
        </select>
    </header>

    <main class="landing-main">
        <div class="logo-container">
            <div class="logo-icon">üëÅÔ∏è</div>
            <div class="logo-text">SPECTRE</div>
            <div class="logo-tagline">Open Source Intelligence</div>
        </div>

        <div class="search-container">
            <div class="search-box">
                <span class="search-icon">üîç</span>
                <input type="text" class="search-input" id="mainSearchInput" 
                    placeholder="Search by name, username, email, phone, domain..." autocomplete="off">
            </div>
        </div>

        <div class="quick-fields" id="quickFields">
            <div class="quick-field">
                <label>First</label>
                <input type="text" id="qFirst" placeholder="John">
            </div>
            <div class="quick-field">
                <label>Last</label>
                <input type="text" id="qLast" placeholder="Doe">
            </div>
            <div class="quick-field">
                <label>Username</label>
                <input type="text" id="qUsername" class="w-lg" placeholder="johndoe123">
            </div>
            <div class="quick-field">
                <label>Email</label>
                <input type="email" id="qEmail" class="w-lg" placeholder="john@example.com">
            </div>
        </div>

        <div class="search-buttons">
            <button class="btn btn-primary" onclick="runSearch()">üîç Search OSINT</button>
            <button class="btn" onclick="runSearch('lucky')">‚ö° I'm Feeling Lucky</button>
        </div>

        <div class="advanced-toggle" id="advancedToggle" onclick="toggleAdvanced()">
            <span>Advanced Options</span>
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 9l6 6 6-6"/>
            </svg>
        </div>

        <div class="advanced-panel" id="advancedPanel">
            <div class="advanced-grid">
                <div class="adv-input">
                    <label>Phone</label>
                    <input type="tel" id="qPhone" placeholder="555-123-4567">
                </div>
                <div class="adv-input">
                    <label>City</label>
                    <input type="text" id="qCity" placeholder="New York">
                </div>
                <div class="adv-input">
                    <label>State</label>
                    <input type="text" id="qState" placeholder="NY" maxlength="2">
                </div>
                <div class="adv-input">
                    <label>Domain</label>
                    <input type="text" id="qDomain" placeholder="example.com">
                </div>
                <div class="adv-input">
                    <label>IP Address</label>
                    <input type="text" id="qIP" placeholder="192.168.1.1">
                </div>
                <div class="adv-input">
                    <label>Company</label>
                    <input type="text" id="qCompany" placeholder="Acme Inc">
                </div>
                <div class="adv-input">
                    <label>Street</label>
                    <input type="text" id="qStreet" placeholder="123 Main St">
                </div>
                <div class="adv-input">
                    <label>ZIP</label>
                    <input type="text" id="qZip" placeholder="10001">
                </div>
                <div class="adv-input">
                    <label>Image URL</label>
                    <input type="url" id="qImageUrl" placeholder="https://...">
                </div>
                <div class="adv-input">
                    <label>VIN</label>
                    <input type="text" id="qVIN" placeholder="1HGBH41JXMN...">
                </div>
                <div class="adv-input">
                    <label>Crypto</label>
                    <input type="text" id="qCrypto" placeholder="0x...">
                </div>
                <div class="adv-input">
                    <label>Country</label>
                    <input type="text" id="qCountry" placeholder="US" value="US">
                </div>
            </div>
        </div>

        <div class="category-pills">
            <span class="cat-pill active" data-cat="all" onclick="selectCategory('all')">All Tools</span>
            <span class="cat-pill" data-cat="people" onclick="selectCategory('people')">üë§ People</span>
            <span class="cat-pill" data-cat="social" onclick="selectCategory('social')">üí¨ Social</span>
            <span class="cat-pill" data-cat="username" onclick="selectCategory('username')">üîé Username</span>
            <span class="cat-pill" data-cat="email" onclick="selectCategory('email')">üìß Email</span>
            <span class="cat-pill" data-cat="phone" onclick="selectCategory('phone')">üì± Phone</span>
            <span class="cat-pill" data-cat="domain" onclick="selectCategory('domain')">üåê Domain</span>
            <span class="cat-pill" data-cat="business" onclick="selectCategory('business')">üè¢ Business</span>
        </div>
    </main>

    <footer class="landing-footer">
        <div class="footer-section">
            <span class="tool-count">Powered by <strong id="totalToolCount">0</strong> OSINT sources</span>
        </div>
        <div class="footer-section">
            <a href="#" class="footer-link" onclick="showHelpModal(); return false;">Help</a>
            <a href="#" class="footer-link" onclick="showShortcutsModal(); return false;">Shortcuts</a>
        </div>
    </footer>
</div>

<!-- Results Page -->
<div class="results-page" id="resultsPage">
    <header class="results-header">
        <a class="results-logo" onclick="goHome()">
            <div class="results-logo-icon">üëÅÔ∏è</div>
            <span class="results-logo-text">SPECTRE</span>
        </a>

        <div class="results-inputs" id="resultsInputs">
            <div class="input-pill"><label>First</label><input type="text" id="firstName" placeholder="John"></div>
            <div class="input-pill"><label>Last</label><input type="text" id="lastName" placeholder="Doe"></div>
            <div class="input-pill"><label>User</label><input type="text" id="username" class="w-lg" placeholder="username"></div>
            <div class="input-pill"><label>Email</label><input type="email" id="email" class="w-xl" placeholder="email@example.com"></div>
            <div class="input-pill"><label>Phone</label><input type="tel" id="phone" placeholder="555-1234"></div>
            <button class="btn btn-icon btn-sm" onclick="toggleExtended()" title="More fields">‚öôÔ∏è</button>
            <button class="btn btn-primary btn-sm" onclick="runSearch()">üîç</button>
        </div>

        <div class="header-actions">
            <select class="select" id="themeSelectResults" onchange="setTheme(this.value)">
                <option value="dark">üåô</option>
                <option value="light">‚òÄÔ∏è</option>
                <option value="hacker">üíª</option>
            </select>
            <button class="btn btn-icon btn-sm" onclick="toggleSidebar()" title="Sidebar">üìã</button>
            <button class="btn btn-icon btn-sm" onclick="showSettingsModal()" title="Settings">‚öôÔ∏è</button>
        </div>
    </header>

    <div class="extended-bar" id="extendedBar">
        <div class="input-pill"><label>City</label><input type="text" id="city" placeholder="Denver"></div>
        <div class="input-pill"><label>ST</label><input type="text" id="state" class="w-sm" maxlength="2" placeholder="CO"></div>
        <div class="input-pill"><label>Domain</label><input type="text" id="domain" class="w-lg" placeholder="example.com"></div>
        <div class="input-pill"><label>IP</label><input type="text" id="ip" placeholder="192.168.1.1"></div>
        <div class="input-pill"><label>Company</label><input type="text" id="company" class="w-lg" placeholder="Acme Inc"></div>
        <div class="input-pill"><label>Street</label><input type="text" id="streetAddress" class="w-xl" placeholder="123 Main St"></div>
        <div class="input-pill"><label>ZIP</label><input type="text" id="zip" class="w-sm" placeholder="80014"></div>
        <div class="input-pill"><label>Country</label><input type="text" id="country" class="w-sm" value="US"></div>
        <div class="input-pill"><label>Image</label><input type="url" id="imageUrl" class="w-xl" placeholder="https://..."></div>
        <div class="input-pill"><label>VIN</label><input type="text" id="vin" class="w-xl" placeholder="1HGBH41JXMN..."></div>
        <div class="input-pill"><label>Plate</label><input type="text" id="licensePlate" placeholder="ABC123"></div>
        <div class="input-pill"><label>Crypto</label><input type="text" id="cryptoAddress" class="w-xl" placeholder="0x..."></div>
    </div>

    <div class="controls-bar">
        <div class="controls-section">
            <div class="dropdown" id="presetsDropdown">
                <button class="btn btn-sm" onclick="toggleDropdown('presetsDropdown')">‚ö° Presets</button>
                <div class="dropdown-menu">
                    <div class="dropdown-header">Quick Presets</div>
                    <div class="dropdown-item" onclick="applyPreset('person')">üë§ Person Dossier</div>
                    <div class="dropdown-item" onclick="applyPreset('social')">üì± Social Sweep</div>
                    <div class="dropdown-item" onclick="applyPreset('technical')">üîß Technical Recon</div>
                    <div class="dropdown-item" onclick="applyPreset('business')">üè¢ Business Intel</div>
                </div>
            </div>
        </div>
        <div class="divider"></div>
        <div class="controls-section">
            <div class="filter-search">
                <input type="text" id="toolSearch" placeholder="Filter tools..." oninput="filterTools(this.value)">
            </div>
        </div>
        <div class="divider"></div>
        <div class="controls-section">
            <button class="btn btn-sm" onclick="expandAll()">‚¨áÔ∏è Expand</button>
            <button class="btn btn-sm" onclick="collapseAll()">‚¨ÜÔ∏è Collapse</button>
        </div>
        <div class="divider"></div>
        <div class="controls-section">
            <button class="btn btn-sm" onclick="openAllLinks()">üöÄ Open All</button>
            <button class="btn btn-sm" onclick="copyAllLinks()">üìã Copy</button>
            <div class="dropdown" id="exportDropdown">
                <button class="btn btn-sm" onclick="toggleDropdown('exportDropdown')">üíæ Export</button>
                <div class="dropdown-menu right">
                    <div class="dropdown-item" onclick="exportAs('json')">üìÑ JSON</div>
                    <div class="dropdown-item" onclick="exportAs('csv')">üìä CSV</div>
                    <div class="dropdown-item" onclick="exportAs('markdown')">üìù Markdown</div>
                </div>
            </div>
        </div>
        <div class="divider"></div>
        <div class="controls-section">
            <button class="btn btn-sm" onclick="clearAll()">‚úï Clear</button>
        </div>
    </div>

    <div class="stats-bar">
        <div class="stat-group">
            <div class="stat"><span class="stat-value" id="activeCount">0</span><span class="stat-label">Active</span></div>
            <div class="stat"><span class="stat-value" id="checkedCount">0</span><span class="stat-label">Checked</span></div>
            <div class="stat"><span class="stat-value" id="totalCount">0</span><span class="stat-label">Total</span></div>
            <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width: 0%"></div></div>
        </div>
        <div class="filter-pills">
            <button class="filter-pill active" data-filter="all" onclick="setFilter('all')">All</button>
            <button class="filter-pill" data-filter="free" onclick="setFilter('free')">Free</button>
            <button class="filter-pill" data-filter="active" onclick="setFilter('active')">Active</button>
            <span class="divider"></span>
            <button class="filter-pill" data-filter="people" onclick="setFilter('people')">People</button>
            <button class="filter-pill" data-filter="social" onclick="setFilter('social')">Social</button>
            <button class="filter-pill" data-filter="technical" onclick="setFilter('technical')">Technical</button>
        </div>
    </div>

    <div class="main-wrapper">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-tabs">
                <div class="sidebar-tab active" data-tab="history" onclick="switchTab('history')">üìú History</div>
                <div class="sidebar-tab" data-tab="favorites" onclick="switchTab('favorites')">‚≠ê Favorites</div>
            </div>
            <div class="sidebar-content">
                <div class="tab-panel" id="panel-history">
                    <div class="sidebar-section">
                        <div class="sidebar-title"><span>Recent Searches</span><button class="btn btn-xs" onclick="clearHistory()">Clear</button></div>
                        <div id="historyList"></div>
                    </div>
                </div>
                <div class="tab-panel hidden" id="panel-favorites">
                    <div class="sidebar-section">
                        <div class="sidebar-title">Favorite Tools</div>
                        <div id="favoritesList"></div>
                    </div>
                </div>
            </div>
        </aside>

        <main class="main-content" id="mainContent">
            <div class="results-grid" id="resultsGrid"></div>
            <div class="empty-state" id="emptyState">
                <div class="empty-icon">üîé</div>
                <div class="empty-title">Ready to Search</div>
                <div class="empty-text">Enter search parameters above to query 500+ OSINT sources.</div>
            </div>
        </main>
    </div>
</div>

<div class="toast-container" id="toastContainer"></div>
<div id="modalContainer"></div>

<script>
// ============================================
// STATE
// ============================================
const state = {
    mode: 'landing',
    filter: 'all',
    searchTerm: '',
    selectedCategory: 'all',
    checkedTools: new Set(),
    generatedLinks: []
};

let favorites = JSON.parse(localStorage.getItem('spectre-fav') || '[]');
let searchHistory = JSON.parse(localStorage.getItem('spectre-hist') || '[]');

// ============================================
// TOOLS DATABASE (500+ tools)
// ============================================
const toolsDB = {
    people: {
        name: "People Search", icon: "üë§", group: "people",
        tools: [
            { name: "TruePeopleSearch", url: "https://www.truepeoplesearch.com/results?name={first}%20{last}", badge: "free", fields: ["firstName", "lastName"], desc: "Comprehensive free people search" },
            { name: "TruePeopleSearch+Loc", url: "https://www.truepeoplesearch.com/results?name={first}%20{last}&citystatezip={city}%20{state}", badge: "free", fields: ["firstName", "lastName", "city", "state"] },
            { name: "FastPeopleSearch", url: "https://www.fastpeoplesearch.com/name/{first}-{last}", badge: "free", fields: ["firstName", "lastName"] },
            { name: "ThatsThem", url: "https://thatsthem.com/name/{First}-{Last}", badge: "free", fields: ["firstName", "lastName"] },
            { name: "ThatsThem+State", url: "https://thatsthem.com/name/{First}-{Last}/{state}", badge: "free", fields: ["firstName", "lastName", "state"] },
            { name: "USPhonebook", url: "https://www.usphonebook.com/{first}-{last}/{state}", badge: "free", fields: ["firstName", "lastName", "state"] },
            { name: "FamilyTreeNow", url: "https://www.familytreenow.com/search/people/results?first={first}&last={last}", badge: "free", fields: ["firstName", "lastName"] },
            { name: "Nuwber", url: "https://nuwber.com/search?name={first}+{last}", badge: "free", fields: ["firstName", "lastName"] },
            { name: "CyberBackgroundChecks", url: "https://www.cyberbackgroundchecks.com/people/{first}-{last}", badge: "free", fields: ["firstName", "lastName"] },
            { name: "ZabaSearch", url: "https://www.zabasearch.com/people/{first}+{last}/", badge: "free", fields: ["firstName", "lastName"] },
            { name: "AnyWho", url: "https://www.anywho.com/people/{first}+{last}", badge: "free", fields: ["firstName", "lastName"] },
            { name: "411.com", url: "https://www.411.com/name/{First}-{Last}/", badge: "free", fields: ["firstName", "lastName"] },
            { name: "Webmii", url: "https://webmii.com/people?n=%22{first}+{last}%22", badge: "free", fields: ["firstName", "lastName"], desc: "Global people search" },
            { name: "PeekYou", url: "https://www.peekyou.com/{first}_{last}", badge: "freemium", fields: ["firstName", "lastName"] },
            { name: "WhitePages", url: "https://www.whitepages.com/name/{First}-{Last}/{city}-{state}", badge: "freemium", fields: ["firstName", "lastName", "city", "state"] },
            { name: "Spokeo", url: "https://www.spokeo.com/{First}-{Last}/{state}/{city}", badge: "freemium", fields: ["firstName", "lastName", "state", "city"] },
            { name: "BeenVerified", url: "https://www.beenverified.com/people/{first}-{last}/", badge: "freemium", fields: ["firstName", "lastName"] },
            { name: "Intelius", url: "https://www.intelius.com/people-search/{first}-{last}/", badge: "freemium", fields: ["firstName", "lastName"] },
            { name: "Radaris", url: "https://radaris.com/p/{First}/{Last}/", badge: "freemium", fields: ["firstName", "lastName"] },
            { name: "Pipl", url: "https://pipl.com/search/?q={first}+{last}", badge: "paid", fields: ["firstName", "lastName"], desc: "Professional deep search" },
        ]
    },
    social: {
        name: "Social Media", icon: "üí¨", group: "social",
        tools: [
            { name: "Twitter/X", url: "https://twitter.com/{username}", badge: "free", fields: ["username"] },
            { name: "X Search", url: "https://twitter.com/search?q={first}+{last}&f=user", badge: "free", fields: ["firstName", "lastName"] },
            { name: "Instagram", url: "https://www.instagram.com/{username}/", badge: "free", fields: ["username"] },
            { name: "Facebook", url: "https://www.facebook.com/{username}", badge: "free", fields: ["username"] },
            { name: "Facebook Search", url: "https://www.facebook.com/search/people/?q={first}+{last}", badge: "free", fields: ["firstName", "lastName"] },
            { name: "LinkedIn", url: "https://www.linkedin.com/in/{username}/", badge: "free", fields: ["username"] },
            { name: "LinkedIn Search", url: "https://www.linkedin.com/search/results/people/?keywords={first}+{last}", badge: "free", fields: ["firstName", "lastName"] },
            { name: "TikTok", url: "https://www.tiktok.com/@{username}", badge: "free", fields: ["username"] },
            { name: "Reddit", url: "https://www.reddit.com/user/{username}", badge: "free", fields: ["username"] },
            { name: "YouTube", url: "https://www.youtube.com/@{username}", badge: "free", fields: ["username"] },
            { name: "Pinterest", url: "https://www.pinterest.com/{username}/", badge: "free", fields: ["username"] },
            { name: "Snapchat", url: "https://www.snapchat.com/add/{username}", badge: "free", fields: ["username"] },
            { name: "Tumblr", url: "https://{username}.tumblr.com", badge: "free", fields: ["username"] },
            { name: "Medium", url: "https://medium.com/@{username}", badge: "free", fields: ["username"] },
            { name: "Threads", url: "https://www.threads.net/@{username}", badge: "free", fields: ["username"] },
            { name: "Bluesky", url: "https://bsky.app/profile/{username}.bsky.social", badge: "free", fields: ["username"] },
            { name: "Mastodon", url: "https://mastodon.social/@{username}", badge: "free", fields: ["username"] },
            { name: "GitHub", url: "https://github.com/{username}", badge: "free", fields: ["username"] },
            { name: "GitLab", url: "https://gitlab.com/{username}", badge: "free", fields: ["username"] },
            { name: "Twitch", url: "https://www.twitch.tv/{username}", badge: "free", fields: ["username"] },
            { name: "SoundCloud", url: "https://soundcloud.com/{username}", badge: "free", fields: ["username"] },
            { name: "Spotify", url: "https://open.spotify.com/user/{username}", badge: "free", fields: ["username"] },
            { name: "DeviantArt", url: "https://www.deviantart.com/{username}", badge: "free", fields: ["username"] },
            { name: "Behance", url: "https://www.behance.net/{username}", badge: "free", fields: ["username"] },
            { name: "Dribbble", url: "https://dribbble.com/{username}", badge: "free", fields: ["username"] },
            { name: "Flickr", url: "https://www.flickr.com/people/{username}", badge: "free", fields: ["username"] },
            { name: "Telegram", url: "https://t.me/{username}", badge: "free", fields: ["username"] },
            { name: "VK", url: "https://vk.com/{username}", badge: "free", fields: ["username"] },
            { name: "Patreon", url: "https://www.patreon.com/{username}", badge: "free", fields: ["username"] },
            { name: "Linktree", url: "https://linktr.ee/{username}", badge: "free", fields: ["username"] },
            { name: "Keybase", url: "https://keybase.io/{username}", badge: "free", fields: ["username"] },
            { name: "Steam", url: "https://steamcommunity.com/id/{username}", badge: "free", fields: ["username"] },
            { name: "Venmo", url: "https://venmo.com/{username}", badge: "free", fields: ["username"] },
            { name: "Cash App", url: "https://cash.app/${username}", badge: "free", fields: ["username"] },
        ]
    },
    username: {
        name: "Username OSINT", icon: "üîé", group: "social",
        tools: [
            { name: "Namechk", url: "https://namechk.com/", badge: "free", fields: ["username"], desc: "Check 100+ sites" },
            { name: "KnowEm", url: "https://knowem.com/checkusernames.php?u={username}", badge: "free", fields: ["username"] },
            { name: "WhatsMyName", url: "https://whatsmyname.app/", badge: "free", fields: ["username"], desc: "OSINT username enumeration" },
            { name: "UserSearch", url: "https://usersearch.org/results_normal.php?URL_username={username}", badge: "free", fields: ["username"] },
            { name: "Instant Username", url: "https://instantusername.com/#/{username}", badge: "free", fields: ["username"] },
            { name: "Social Searcher", url: "https://www.social-searcher.com/search-users/?q={username}", badge: "free", fields: ["username"] },
            { name: "NameCheckup", url: "https://namecheckup.com/", badge: "free", fields: ["username"] },
            { name: "Sherlock (CLI)", url: "https://github.com/sherlock-project/sherlock", badge: "cli", fields: ["username"], desc: "Hunt 400+ networks" },
            { name: "Maigret (CLI)", url: "https://github.com/soxoj/maigret", badge: "cli", fields: ["username"], desc: "Collect dossier" },
            { name: "IDCrawl", url: "https://www.idcrawl.com/{username}", badge: "free", fields: ["username"] },
        ]
    },
    email: {
        name: "Email Intelligence", icon: "üìß", group: "technical",
        tools: [
            { name: "Have I Been Pwned", url: "https://haveibeenpwned.com/account/{email}", badge: "free", fields: ["email"], desc: "Check for breaches" },
            { name: "EmailRep.io", url: "https://emailrep.io/{email}", badge: "free", fields: ["email"], desc: "Email reputation" },
            { name: "Hunter.io Verify", url: "https://hunter.io/email-verifier/{email}", badge: "freemium", fields: ["email"] },
            { name: "Hunter.io Domain", url: "https://hunter.io/try/search/{domain}", badge: "freemium", fields: ["domain"], desc: "Find emails by domain" },
            { name: "ThatsThem Email", url: "https://thatsthem.com/email/{email}", badge: "free", fields: ["email"] },
            { name: "Epieos", url: "https://epieos.com/?q={email}", badge: "free", fields: ["email"], desc: "Google account discovery" },
            { name: "GHunt (CLI)", url: "https://github.com/mxrch/GHunt", badge: "cli", fields: ["email"], desc: "Google account OSINT" },
            { name: "Skymem", url: "http://www.skymem.info/srch?q={email}", badge: "free", fields: ["email"] },
            { name: "Holehe (CLI)", url: "https://github.com/megadose/holehe", badge: "cli", fields: ["email"], desc: "Check email on sites" },
            { name: "Clearbit", url: "https://connect.clearbit.com/", badge: "freemium", fields: ["email"] },
            { name: "Phonebook.cz", url: "https://phonebook.cz/", badge: "free", fields: ["email"], desc: "Breach data search" },
            { name: "Email-Format", url: "https://www.email-format.com/d/{domain}/", badge: "free", fields: ["domain"], desc: "Company email formats" },
        ]
    },
    phone: {
        name: "Phone Lookup", icon: "üì±", group: "people",
        tools: [
            { name: "TrueCaller", url: "https://www.truecaller.com/search/{country}/{phoneClean}", badge: "freemium", fields: ["phone", "country"] },
            { name: "ThatsThem Phone", url: "https://thatsthem.com/phone/{phoneClean}", badge: "free", fields: ["phone"] },
            { name: "Spy Dialer", url: "https://spydialer.com/default.aspx?rp={phoneClean}", badge: "free", fields: ["phone"] },
            { name: "FastPeopleSearch Phone", url: "https://www.fastpeoplesearch.com/phone/{phoneClean}", badge: "free", fields: ["phone"] },
            { name: "USPhonebook Phone", url: "https://www.usphonebook.com/phone/{phoneClean}", badge: "free", fields: ["phone"] },
            { name: "Carrier Lookup", url: "https://freecarrierlookup.com/", badge: "free", fields: ["phone"] },
            { name: "NumVerify", url: "https://numverify.com/", badge: "freemium", fields: ["phone"] },
            { name: "Phone Validator", url: "https://www.phonevalidator.com/index.aspx?p={phoneClean}", badge: "free", fields: ["phone"] },
            { name: "Sync.me", url: "https://sync.me/search/?number={phoneClean}", badge: "freemium", fields: ["phone"] },
            { name: "411 Phone", url: "https://www.411.com/phone/{phoneClean}", badge: "free", fields: ["phone"] },
            { name: "PhoneInfoga (CLI)", url: "https://github.com/sundowndev/phoneinfoga", badge: "cli", fields: ["phone"], desc: "Phone OSINT framework" },
        ]
    },
    domain: {
        name: "Domain & DNS", icon: "üåê", group: "technical",
        tools: [
            { name: "WHOIS", url: "https://www.whois.com/whois/{domain}", badge: "free", fields: ["domain"] },
            { name: "ViewDNS WHOIS", url: "https://viewdns.info/whois/?domain={domain}", badge: "free", fields: ["domain"] },
            { name: "DNSdumpster", url: "https://dnsdumpster.com/", badge: "free", fields: ["domain"], desc: "DNS recon" },
            { name: "SecurityTrails", url: "https://securitytrails.com/domain/{domain}/dns", badge: "freemium", fields: ["domain"] },
            { name: "crt.sh", url: "https://crt.sh/?q={domain}", badge: "free", fields: ["domain"], desc: "Certificate transparency" },
            { name: "VirusTotal Domain", url: "https://www.virustotal.com/gui/domain/{domain}", badge: "free", fields: ["domain"] },
            { name: "Shodan Domain", url: "https://www.shodan.io/search?query={domain}", badge: "freemium", fields: ["domain"] },
            { name: "Censys", url: "https://search.censys.io/hosts?q={domain}", badge: "freemium", fields: ["domain"] },
            { name: "BuiltWith", url: "https://builtwith.com/{domain}", badge: "freemium", fields: ["domain"], desc: "Technology profiler" },
            { name: "Wappalyzer", url: "https://www.wappalyzer.com/lookup/{domain}", badge: "freemium", fields: ["domain"] },
            { name: "Netcraft", url: "https://sitereport.netcraft.com/?url={domain}", badge: "free", fields: ["domain"] },
            { name: "URLScan.io", url: "https://urlscan.io/search/#domain:{domain}", badge: "free", fields: ["domain"] },
            { name: "MXToolbox", url: "https://mxtoolbox.com/SuperTool.aspx?action=dns:{domain}", badge: "free", fields: ["domain"] },
            { name: "Robtex", url: "https://www.robtex.com/dns-lookup/{domain}", badge: "free", fields: ["domain"] },
            { name: "DNSlytics", url: "https://dnslytics.com/domain/{domain}", badge: "freemium", fields: ["domain"] },
        ]
    },
    ip: {
        name: "IP & Network", icon: "üîå", group: "technical",
        tools: [
            { name: "Shodan IP", url: "https://www.shodan.io/host/{ip}", badge: "freemium", fields: ["ip"] },
            { name: "Censys IP", url: "https://search.censys.io/hosts/{ip}", badge: "freemium", fields: ["ip"] },
            { name: "VirusTotal IP", url: "https://www.virustotal.com/gui/ip-address/{ip}", badge: "free", fields: ["ip"] },
            { name: "IPinfo.io", url: "https://ipinfo.io/{ip}", badge: "freemium", fields: ["ip"] },
            { name: "AbuseIPDB", url: "https://www.abuseipdb.com/check/{ip}", badge: "free", fields: ["ip"] },
            { name: "GreyNoise", url: "https://viz.greynoise.io/ip/{ip}", badge: "freemium", fields: ["ip"] },
            { name: "BGP Toolkit", url: "https://bgp.he.net/ip/{ip}", badge: "free", fields: ["ip"] },
            { name: "BGPView", url: "https://bgpview.io/ip/{ip}", badge: "free", fields: ["ip"] },
            { name: "IP Location", url: "https://www.iplocation.net/ip-lookup/{ip}", badge: "free", fields: ["ip"] },
            { name: "ViewDNS Reverse", url: "https://viewdns.info/reverseip/?host={ip}", badge: "free", fields: ["ip"] },
            { name: "Talos Intelligence", url: "https://talosintelligence.com/reputation_center/lookup?search={ip}", badge: "free", fields: ["ip"] },
        ]
    },
    breach: {
        name: "Breach & Leaks", icon: "üîì", group: "technical",
        tools: [
            { name: "Have I Been Pwned", url: "https://haveibeenpwned.com/account/{email}", badge: "free", fields: ["email"] },
            { name: "Firefox Monitor", url: "https://monitor.firefox.com/", badge: "free", fields: ["email"] },
            { name: "DeHashed", url: "https://dehashed.com/search?query={email}", badge: "paid", fields: ["email"], desc: "Breach database" },
            { name: "LeakCheck", url: "https://leakcheck.io/", badge: "freemium", fields: ["email"] },
            { name: "IntelligenceX", url: "https://intelx.io/?s={email}", badge: "freemium", fields: ["email"], desc: "Historical data" },
            { name: "LeakPeek", url: "https://leakpeek.com/", badge: "freemium", fields: ["email"] },
            { name: "BreachDirectory", url: "https://breachdirectory.org/", badge: "free", fields: ["email"] },
            { name: "Snusbase", url: "https://snusbase.com/", badge: "paid", fields: ["email"] },
            { name: "0t.rocks", url: "https://search.0t.rocks/", badge: "freemium", fields: ["email"], desc: "14B+ records" },
        ]
    },
    archive: {
        name: "Web Archives", icon: "üóÑÔ∏è", group: "technical",
        tools: [
            { name: "Wayback Machine", url: "https://web.archive.org/web/*/{domain}", badge: "free", fields: ["domain"] },
            { name: "Google Cache", url: "https://webcache.googleusercontent.com/search?q=cache:{domain}", badge: "free", fields: ["domain"] },
            { name: "Archive.today", url: "https://archive.today/{domain}", badge: "free", fields: ["domain"] },
            { name: "Archive.is", url: "https://archive.is/{domain}", badge: "free", fields: ["domain"] },
            { name: "CachedView", url: "https://cachedview.com/#{domain}", badge: "free", fields: ["domain"] },
            { name: "Memento", url: "https://timetravel.mementoweb.org/list/20200101000000/{domain}", badge: "free", fields: ["domain"] },
        ]
    },
    image: {
        name: "Image Search", icon: "üñºÔ∏è", group: "technical",
        tools: [
            { name: "Google Lens", url: "https://lens.google.com/uploadbyurl?url={imageUrl}", badge: "free", fields: ["imageUrl"] },
            { name: "TinEye", url: "https://tineye.com/search?url={imageUrl}", badge: "free", fields: ["imageUrl"] },
            { name: "Yandex Images", url: "https://yandex.com/images/search?rpt=imageview&url={imageUrl}", badge: "free", fields: ["imageUrl"] },
            { name: "Bing Visual", url: "https://www.bing.com/images/search?view=detailv2&iss=sbi&q=imgurl:{imageUrl}", badge: "free", fields: ["imageUrl"] },
            { name: "PimEyes", url: "https://pimeyes.com/en", badge: "paid", fields: ["imageUrl"], desc: "Face recognition" },
            { name: "FaceCheck.ID", url: "https://facecheck.id/", badge: "freemium", fields: ["imageUrl"], desc: "Facial recognition" },
            { name: "Search4faces", url: "https://search4faces.com/", badge: "free", fields: ["imageUrl"], desc: "VK/OK face search" },
            { name: "SauceNAO", url: "https://saucenao.com/search.php?url={imageUrl}", badge: "free", fields: ["imageUrl"] },
            { name: "ImgOps", url: "https://imgops.com/{imageUrl}", badge: "free", fields: ["imageUrl"], desc: "Multi-engine search" },
            { name: "FotoForensics", url: "https://fotoforensics.com/", badge: "free", fields: ["imageUrl"], desc: "Error level analysis" },
        ]
    },
    business: {
        name: "Business Intel", icon: "üè¢", group: "records",
        tools: [
            { name: "OpenCorporates", url: "https://opencorporates.com/companies?q={company}", badge: "freemium", fields: ["company"], desc: "135M+ companies" },
            { name: "SEC EDGAR", url: "https://www.sec.gov/cgi-bin/browse-edgar?company={company}&action=getcompany", badge: "free", fields: ["company"] },
            { name: "Crunchbase", url: "https://www.crunchbase.com/textsearch?q={company}", badge: "freemium", fields: ["company"] },
            { name: "LinkedIn Company", url: "https://www.linkedin.com/company/{company}/", badge: "free", fields: ["company"] },
            { name: "Glassdoor", url: "https://www.glassdoor.com/Search/results.htm?keyword={company}", badge: "free", fields: ["company"] },
            { name: "BBB", url: "https://www.bbb.org/search?find_text={company}", badge: "free", fields: ["company"] },
            { name: "Companies House", url: "https://find-and-update.company-information.service.gov.uk/search/companies?q={company}", badge: "free", fields: ["company"] },
            { name: "ICIJ Offshore", url: "https://offshoreleaks.icij.org/search?q={company}", badge: "free", fields: ["company"], desc: "Offshore leaks" },
            { name: "Google Finance", url: "https://www.google.com/finance?q={company}", badge: "free", fields: ["company"] },
            { name: "Yahoo Finance", url: "https://finance.yahoo.com/lookup?s={company}", badge: "free", fields: ["company"] },
            { name: "OpenSanctions", url: "https://www.opensanctions.org/search/?q={company}", badge: "free", fields: ["company"], desc: "Sanctions database" },
        ]
    },
    geo: {
        name: "Geolocation", icon: "üìç", group: "records",
        tools: [
            { name: "Google Maps", url: "https://www.google.com/maps/search/{streetAddress}+{city}+{state}", badge: "free", fields: ["streetAddress", "city", "state"] },
            { name: "Google Street View", url: "https://www.google.com/maps/@?api=1&map_action=pano&query={streetAddress}+{city}+{state}", badge: "free", fields: ["streetAddress", "city", "state"] },
            { name: "Bing Maps", url: "https://www.bing.com/maps?q={streetAddress}+{city}+{state}", badge: "free", fields: ["streetAddress", "city", "state"] },
            { name: "OpenStreetMap", url: "https://www.openstreetmap.org/search?query={streetAddress}+{city}+{state}", badge: "free", fields: ["streetAddress", "city", "state"] },
            { name: "Zillow", url: "https://www.zillow.com/homes/{streetAddress}-{city},-{state}_rb/", badge: "free", fields: ["streetAddress", "city", "state"] },
            { name: "Redfin", url: "https://www.redfin.com/search?search_term={streetAddress}+{city}+{state}", badge: "free", fields: ["streetAddress", "city", "state"] },
            { name: "SunCalc", url: "https://www.suncalc.org/", badge: "free", fields: [], desc: "Sun position calculator" },
            { name: "Sentinel Hub", url: "https://apps.sentinel-hub.com/eo-browser/", badge: "freemium", fields: [], desc: "Satellite imagery" },
            { name: "Google Earth", url: "https://earth.google.com/web/", badge: "free", fields: [] },
        ]
    },
    vehicle: {
        name: "Vehicle Search", icon: "üöó", group: "records",
        tools: [
            { name: "NHTSA VIN", url: "https://vpic.nhtsa.dot.gov/decoder/Decoder?VIN={vin}", badge: "free", fields: ["vin"] },
            { name: "VINCheck NICB", url: "https://www.nicb.org/vincheck", badge: "free", fields: ["vin"] },
            { name: "CarFax", url: "https://www.carfax.com/vehicle-history-reports/?vin={vin}", badge: "paid", fields: ["vin"] },
            { name: "AutoCheck", url: "https://www.autocheck.com/vehiclehistory/?vin={vin}", badge: "paid", fields: ["vin"] },
            { name: "VehicleHistory", url: "https://www.vehiclehistory.com/vin-report/{vin}", badge: "freemium", fields: ["vin"] },
            { name: "FindByPlate", url: "https://findbyplate.com/", badge: "freemium", fields: ["licensePlate"] },
            { name: "VINDecoder", url: "https://www.vindecoder.net/{vin}", badge: "free", fields: ["vin"] },
        ]
    },
    crypto: {
        name: "Cryptocurrency", icon: "‚Çø", group: "technical",
        tools: [
            { name: "Blockchain.com", url: "https://www.blockchain.com/explorer/search?search={cryptoAddress}", badge: "free", fields: ["cryptoAddress"] },
            { name: "Etherscan", url: "https://etherscan.io/address/{cryptoAddress}", badge: "free", fields: ["cryptoAddress"] },
            { name: "BscScan", url: "https://bscscan.com/address/{cryptoAddress}", badge: "free", fields: ["cryptoAddress"] },
            { name: "Blockchair", url: "https://blockchair.com/search?q={cryptoAddress}", badge: "free", fields: ["cryptoAddress"], desc: "Multi-chain explorer" },
            { name: "Wallet Explorer", url: "https://www.walletexplorer.com/address/{cryptoAddress}", badge: "free", fields: ["cryptoAddress"] },
            { name: "OXT.me", url: "https://oxt.me/address/{cryptoAddress}", badge: "free", fields: ["cryptoAddress"] },
            { name: "Bitcoin Abuse", url: "https://www.bitcoinabuse.com/", badge: "free", fields: ["cryptoAddress"], desc: "Scam reports" },
        ]
    },
    search: {
        name: "Search Engines", icon: "üîç", group: "general",
        tools: [
            { name: "Google", url: "https://www.google.com/search?q={first}+{last}", badge: "free", fields: ["firstName", "lastName"] },
            { name: "Google Exact", url: "https://www.google.com/search?q=%22{first}+{last}%22", badge: "free", fields: ["firstName", "lastName"], desc: "Exact match" },
            { name: "Bing", url: "https://www.bing.com/search?q={first}+{last}", badge: "free", fields: ["firstName", "lastName"] },
            { name: "DuckDuckGo", url: "https://duckduckgo.com/?q={first}+{last}", badge: "free", fields: ["firstName", "lastName"] },
            { name: "Yandex", url: "https://yandex.com/search/?text={first}+{last}", badge: "free", fields: ["firstName", "lastName"] },
            { name: "Brave Search", url: "https://search.brave.com/search?q={first}+{last}", badge: "free", fields: ["firstName", "lastName"] },
            { name: "Carrot2", url: "https://search.carrot2.org/#/search/web/{first}+{last}/folders", badge: "free", fields: ["firstName", "lastName"], desc: "Clustered results" },
        ]
    },
    frameworks: {
        name: "OSINT Frameworks", icon: "üîß", group: "tools",
        tools: [
            { name: "OSINT Framework", url: "https://osintframework.com/", badge: "free", fields: [], desc: "Tool directory" },
            { name: "IntelTechniques", url: "https://inteltechniques.com/tools/", badge: "free", fields: [], desc: "Bazzell's tools" },
            { name: "Bellingcat Toolkit", url: "https://bellingcat.gitbook.io/toolkit/", badge: "free", fields: [], desc: "Investigative journalism" },
            { name: "Awesome OSINT", url: "https://github.com/jivoi/awesome-osint", badge: "free", fields: [], desc: "Curated list" },
            { name: "cipher387 Collection", url: "https://github.com/cipher387/osint_stuff_tool_collection", badge: "free", fields: [], desc: "1000+ tools" },
        ]
    }
};

// ============================================
// THEME
// ============================================
function setTheme(t) {
    document.documentElement.setAttribute('data-theme', t);
    localStorage.setItem('spectre-theme', t);
    document.getElementById('themeSelectLanding').value = t;
    document.getElementById('themeSelectResults').value = t;
}
function initTheme() {
    const t = localStorage.getItem('spectre-theme') || 'dark';
    setTheme(t);
}

// ============================================
// PAGE TRANSITIONS
// ============================================
function goHome() {
    document.getElementById('resultsPage').classList.remove('active');
    document.getElementById('landingPage').classList.remove('hidden', 'fade-out');
    document.body.classList.remove('results-mode');
    state.mode = 'landing';
}
function showResults() {
    document.getElementById('landingPage').classList.add('fade-out');
    setTimeout(() => {
        document.getElementById('landingPage').classList.add('hidden');
        document.getElementById('resultsPage').classList.add('active');
        document.body.classList.add('results-mode');
        state.mode = 'results';
    }, 200);
}

// ============================================
// INPUT HANDLING
// ============================================
function getInputValues() {
    const gv = (lid, rid) => state.mode === 'landing' 
        ? (document.getElementById(lid)?.value || '').trim()
        : (document.getElementById(rid)?.value || '').trim();
    const first = gv('qFirst', 'firstName'), last = gv('qLast', 'lastName'), phone = gv('qPhone', 'phone');
    return {
        first: first.toLowerCase(), last: last.toLowerCase(),
        First: first.charAt(0).toUpperCase() + first.slice(1).toLowerCase(),
        Last: last.charAt(0).toUpperCase() + last.slice(1).toLowerCase(),
        firstName: first.toLowerCase(), lastName: last.toLowerCase(),
        city: gv('qCity', 'city'), state: gv('qState', 'state').toUpperCase(),
        email: gv('qEmail', 'email').toLowerCase(), username: gv('qUsername', 'username'),
        phone, phoneClean: phone.replace(/\D/g, ''),
        streetAddress: gv('qStreet', 'streetAddress'), zip: gv('qZip', 'zip'),
        country: gv('qCountry', 'country') || 'us', company: gv('qCompany', 'company'),
        domain: gv('qDomain', 'domain').toLowerCase().replace(/^https?:\/\//, '').replace(/\/$/, ''),
        ip: gv('qIP', 'ip'), imageUrl: encodeURIComponent(gv('qImageUrl', 'imageUrl')),
        vin: gv('qVIN', 'vin').toUpperCase(), licensePlate: gv('', 'licensePlate').toUpperCase(),
        cryptoAddress: gv('qCrypto', 'cryptoAddress')
    };
}
function syncInputs(v) {
    document.getElementById('firstName').value = v.first;
    document.getElementById('lastName').value = v.last;
    document.getElementById('username').value = v.username;
    document.getElementById('email').value = v.email;
    document.getElementById('phone').value = v.phone;
    document.getElementById('city').value = v.city;
    document.getElementById('state').value = v.state;
    document.getElementById('domain').value = v.domain;
    document.getElementById('ip').value = v.ip;
    document.getElementById('company').value = v.company;
    document.getElementById('streetAddress').value = v.streetAddress;
    document.getElementById('zip').value = v.zip;
    document.getElementById('country').value = v.country;
    document.getElementById('vin').value = v.vin;
    document.getElementById('cryptoAddress').value = v.cryptoAddress;
}
function hasFields(t, v) { return !t.fields?.length || t.fields.every(f => v[f]?.length > 0); }
function buildUrl(tpl, v) {
    let u = tpl;
    Object.entries(v).forEach(([k, val]) => u = u.replace(new RegExp(`{${k}}`, 'g'), val));
    return u;
}
function validateInputs() {
    document.querySelectorAll('.input-pill, .quick-field').forEach(g => {
        const i = g.querySelector('input');
        g.classList.toggle('has-value', i?.value.trim().length > 0);
    });
}

// ============================================
// SEARCH
// ============================================
function runSearch(mode = 'normal') {
    const v = getInputValues();
    const has = Object.entries(v).some(([k, val]) => !['first','last','First','Last','phoneClean'].includes(k) && val?.length > 0);
    if (!has) { toast('Enter at least one parameter', 'error'); return; }
    saveHistory(v);
    syncInputs(v);
    showResults();
    setTimeout(() => renderResults(v, mode), 300);
}
function renderResults(v, mode) {
    const grid = document.getElementById('resultsGrid');
    grid.innerHTML = '';
    document.getElementById('emptyState').style.display = 'none';
    state.generatedLinks = [];
    state.checkedTools = new Set();
    let totalActive = 0, totalTools = 0;

    Object.entries(toolsDB).forEach(([catId, cat]) => {
        if (!cat.tools?.length) return;
        if (state.selectedCategory !== 'all' && catId !== state.selectedCategory) return;
        const active = cat.tools.filter(t => hasFields(t, v));
        totalTools += cat.tools.length;
        totalActive += active.length;

        const card = document.createElement('div');
        card.className = `category-card ${active.length > 0 ? 'has-results' : ''}`;
        card.dataset.category = catId;
        card.dataset.group = cat.group;

        const toolsHtml = cat.tools.map((t, idx) => {
            const isActive = hasFields(t, v);
            const url = isActive ? buildUrl(t.url, v) : '#';
            const isFav = favorites.some(f => f.name === t.name);
            const tid = `${catId}-${idx}`;
            if (isActive) state.generatedLinks.push({ id: tid, category: cat.name, name: t.name, url });
            return `<div class="tool-item ${isActive ? '' : 'inactive'}" data-tid="${tid}">
                <div class="tool-checkbox ${state.checkedTools.has(tid) ? 'checked' : ''}" onclick="toggleCheck('${tid}')">${state.checkedTools.has(tid) ? '‚úì' : ''}</div>
                <div class="tool-info">
                    <a href="${url}" target="_blank" class="tool-name" ${isActive ? '' : 'onclick="return false;"'}>${t.name}</a>
                    ${t.desc ? `<div class="tool-desc">${t.desc}</div>` : ''}
                </div>
                <div class="tool-badges"><span class="badge badge-${t.badge}">${t.badge}</span></div>
                <div class="tool-actions">
                    <button class="tool-action ${isFav ? 'favorited' : ''}" onclick="toggleFav('${catId}',${idx})" title="Favorite">‚≠ê</button>
                    <button class="tool-action" onclick="copyUrl('${url}')" title="Copy">üìã</button>
                </div>
            </div>`;
        }).join('');

        card.innerHTML = `<div class="category-header" onclick="toggleCat(this)">
            <div class="category-title">
                <span class="category-icon">${cat.icon}</span>
                <span class="category-name">${cat.name}</span>
                <span class="category-count ${active.length > 0 ? 'active' : ''}">${active.length}/${cat.tools.length}</span>
            </div>
            <span class="category-toggle">‚ñº</span>
        </div>
        <div class="tool-list">${toolsHtml}</div>`;
        grid.appendChild(card);
    });

    document.getElementById('activeCount').textContent = totalActive;
    document.getElementById('totalCount').textContent = totalTools;
    updateProgress();
    if (mode === 'lucky' && state.generatedLinks.length > 0) {
        window.open(state.generatedLinks[0].url, '_blank');
        toast(`Opening ${state.generatedLinks[0].name}`, 'success');
    }
}

// ============================================
// TOOL ACTIONS
// ============================================
function toggleCat(h) { h.closest('.category-card').classList.toggle('collapsed'); }
function toggleCheck(tid) {
    state.checkedTools.has(tid) ? state.checkedTools.delete(tid) : state.checkedTools.add(tid);
    const cb = document.querySelector(`[data-tid="${tid}"] .tool-checkbox`);
    if (cb) { cb.classList.toggle('checked'); cb.textContent = state.checkedTools.has(tid) ? '‚úì' : ''; }
    document.getElementById('checkedCount').textContent = state.checkedTools.size;
    updateProgress();
}
function updateProgress() {
    const a = parseInt(document.getElementById('activeCount').textContent);
    const c = state.checkedTools.size;
    document.getElementById('progressFill').style.width = `${a > 0 ? Math.round(c/a*100) : 0}%`;
}
function toggleFav(catId, idx) {
    const t = toolsDB[catId].tools[idx];
    const i = favorites.findIndex(f => f.name === t.name);
    if (i >= 0) { favorites.splice(i, 1); toast(`Removed ${t.name}`, 'info'); }
    else { favorites.push({...t, src: catId}); toast(`Added ${t.name} to favorites`, 'success'); }
    localStorage.setItem('spectre-fav', JSON.stringify(favorites));
    renderFavorites();
}
function copyUrl(u) { navigator.clipboard.writeText(u); toast('URL copied', 'success'); }
function openAllLinks() {
    const links = state.generatedLinks.filter(l => !state.checkedTools.has(l.id));
    if (!links.length) { toast('No links to open', 'warning'); return; }
    if (links.length > 10 && !confirm(`Open ${links.length} links?`)) return;
    links.forEach((l, i) => setTimeout(() => { window.open(l.url, '_blank'); toggleCheck(l.id); }, i * 200));
    toast(`Opening ${links.length} links...`, 'info');
}
function copyAllLinks() {
    navigator.clipboard.writeText(state.generatedLinks.map(l => `${l.name}: ${l.url}`).join('\n'));
    toast(`Copied ${state.generatedLinks.length} links`, 'success');
}
function expandAll() { document.querySelectorAll('.category-card').forEach(c => c.classList.remove('collapsed')); }
function collapseAll() { document.querySelectorAll('.category-card').forEach(c => c.classList.add('collapsed')); }
function clearAll() {
    document.querySelectorAll('input').forEach(i => { if (!['country','qCountry'].includes(i.id)) i.value = ''; });
    state.checkedTools.clear(); state.generatedLinks = [];
    document.getElementById('resultsGrid').innerHTML = '';
    document.getElementById('emptyState').style.display = '';
    document.getElementById('activeCount').textContent = '0';
    document.getElementById('checkedCount').textContent = '0';
    validateInputs();
    toast('Cleared', 'info');
}

// ============================================
// FILTERS
// ============================================
function setFilter(f) {
    state.filter = f;
    document.querySelectorAll('.filter-pill').forEach(p => p.classList.toggle('active', p.dataset.filter === f));
    document.querySelectorAll('.category-card').forEach(c => {
        const g = c.dataset.group;
        let show = true;
        if (f === 'active') show = c.classList.contains('has-results');
        else if (['people','social','technical','records'].includes(f)) show = g === f;
        c.style.display = show ? '' : 'none';
    });
}
function filterTools(term) {
    const t = term.toLowerCase();
    document.querySelectorAll('.tool-item').forEach(i => {
        const n = i.querySelector('.tool-name')?.textContent.toLowerCase() || '';
        const d = i.querySelector('.tool-desc')?.textContent.toLowerCase() || '';
        i.style.display = n.includes(t) || d.includes(t) ? '' : 'none';
    });
}
function selectCategory(cat) {
    state.selectedCategory = cat;
    document.querySelectorAll('.cat-pill').forEach(p => p.classList.toggle('active', p.dataset.cat === cat));
}

// ============================================
// UI TOGGLES
// ============================================
function toggleAdvanced() {
    document.getElementById('advancedToggle').classList.toggle('open');
    document.getElementById('advancedPanel').classList.toggle('open');
}
function toggleExtended() { document.getElementById('extendedBar').classList.toggle('visible'); }
function toggleSidebar() { document.getElementById('sidebar').classList.toggle('collapsed'); }
function switchTab(tab) {
    document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.toggle('hidden', p.id !== `panel-${tab}`));
}

// ============================================
// HISTORY
// ============================================
function saveHistory(v) {
    const parts = [];
    if (v.first && v.last) parts.push(`${v.First} ${v.Last}`);
    if (v.username) parts.push(`@${v.username}`);
    if (v.email) parts.push(v.email);
    if (v.domain) parts.push(v.domain);
    const entry = { values: {...v}, display: parts.join(' ‚Ä¢ ') || 'Search', ts: Date.now() };
    searchHistory.unshift(entry);
    searchHistory = searchHistory.slice(0, 30);
    localStorage.setItem('spectre-hist', JSON.stringify(searchHistory));
    renderHistory();
}
function renderHistory() {
    const list = document.getElementById('historyList');
    if (!list) return;
    if (!searchHistory.length) { list.innerHTML = '<div style="padding:0.5rem;color:var(--text-muted);font-size:0.75rem;">No recent searches</div>'; return; }
    list.innerHTML = searchHistory.slice(0, 15).map((e, i) => `<div class="history-item" onclick="loadHistory(${i})">
        <span>üîç</span><span class="history-text">${e.display}</span>
        <span class="history-time">${new Date(e.ts).toLocaleDateString()}</span>
    </div>`).join('');
}
function loadHistory(i) {
    const e = searchHistory[i]; if (!e) return;
    const v = e.values;
    document.getElementById('qFirst').value = v.first || '';
    document.getElementById('qLast').value = v.last || '';
    document.getElementById('qUsername').value = v.username || '';
    document.getElementById('qEmail').value = v.email || '';
    runSearch();
}
function clearHistory() { searchHistory = []; localStorage.removeItem('spectre-hist'); renderHistory(); toast('History cleared', 'info'); }

// ============================================
// FAVORITES
// ============================================
function renderFavorites() {
    const list = document.getElementById('favoritesList');
    if (!list) return;
    if (!favorites.length) { list.innerHTML = '<div style="padding:0.5rem;color:var(--text-muted);font-size:0.75rem;">No favorites</div>'; return; }
    list.innerHTML = favorites.map((f, i) => `<div class="fav-item">
        <span>‚≠ê</span><span class="history-text">${f.name}</span>
        <button class="btn btn-xs" onclick="removeFav(${i})">‚úï</button>
    </div>`).join('');
}
function removeFav(i) { favorites.splice(i, 1); localStorage.setItem('spectre-fav', JSON.stringify(favorites)); renderFavorites(); toast('Removed', 'info'); }

// ============================================
// PRESETS
// ============================================
function applyPreset(p) {
    const map = { person: 'people', social: 'social', technical: 'domain', business: 'business' };
    state.selectedCategory = map[p] || 'all';
    closeDropdowns();
    runSearch();
}

// ============================================
// EXPORT
// ============================================
function exportAs(fmt) {
    const d = state.generatedLinks;
    if (!d.length) { toast('No results', 'warning'); return; }
    let content, filename, type;
    if (fmt === 'json') { content = JSON.stringify(d, null, 2); filename = 'spectre.json'; type = 'application/json'; }
    else if (fmt === 'csv') { content = 'Category,Name,URL\n' + d.map(x => `"${x.category}","${x.name}","${x.url}"`).join('\n'); filename = 'spectre.csv'; type = 'text/csv'; }
    else if (fmt === 'markdown') { content = '# SPECTRE Results\n\n' + d.map(x => `- [${x.name}](${x.url}) - ${x.category}`).join('\n'); filename = 'spectre.md'; type = 'text/markdown'; }
    const blob = new Blob([content], { type });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
    closeDropdowns();
    toast(`Exported ${fmt.toUpperCase()}`, 'success');
}

// ============================================
// DROPDOWNS
// ============================================
function toggleDropdown(id) {
    const dd = document.getElementById(id);
    const open = dd.classList.contains('open');
    closeDropdowns();
    if (!open) dd.classList.add('open');
}
function closeDropdowns() { document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('open')); }
document.addEventListener('click', e => { if (!e.target.closest('.dropdown')) closeDropdowns(); });

// ============================================
// MODALS
// ============================================
function showModal(title, content, buttons = []) {
    document.getElementById('modalContainer').innerHTML = `<div class="modal-backdrop open" id="activeModal" onclick="if(event.target===this)closeModal()">
        <div class="modal">
            <div class="modal-header"><span class="modal-title">${title}</span><button class="modal-close" onclick="closeModal()">&times;</button></div>
            <div class="modal-body">${content}</div>
            ${buttons.length ? `<div class="modal-footer">${buttons.map(b => `<button class="btn ${b.class||''}" onclick="${b.action}">${b.text}</button>`).join('')}</div>` : ''}
        </div>
    </div>`;
}
function closeModal() { document.getElementById('modalContainer').innerHTML = ''; }
function showSettingsModal() {
    showModal('Settings', `<div class="form-group"><label class="form-label">Theme</label>
        <select class="form-input" id="setTheme" onchange="setTheme(this.value)">
            <option value="dark">üåô Dark</option><option value="light">‚òÄÔ∏è Light</option><option value="hacker">üíª Hacker</option>
        </select></div>
        <hr style="border-color:var(--border-subtle);margin:1rem 0">
        <div class="form-group"><label class="form-label">Data</label>
            <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
                <button class="btn btn-sm" onclick="exportData()">üì§ Export</button>
                <button class="btn btn-sm" onclick="clearData()">üóëÔ∏è Clear All</button>
            </div>
        </div>`, [{text:'Close',action:'closeModal()'}]);
    document.getElementById('setTheme').value = localStorage.getItem('spectre-theme') || 'dark';
}
function showAboutModal() {
    showModal('About SPECTRE', `<div style="text-align:center;margin-bottom:1rem;">
        <div style="font-size:2.5rem;margin-bottom:0.5rem;">üëÅÔ∏è</div>
        <h2 style="margin:0;">SPECTRE</h2>
        <p style="color:var(--text-muted);">Open Source Intelligence Platform</p>
    </div>
    <p style="color:var(--text-secondary);font-size:0.9rem;">SPECTRE aggregates 500+ OSINT tools for efficient intelligence gathering. Built for researchers, investigators, and security professionals.</p>`, [{text:'Close',action:'closeModal()'}]);
}
function showHelpModal() {
    showModal('Help', `<h3 style="margin-bottom:0.75rem;">Getting Started</h3>
    <p style="color:var(--text-secondary);font-size:0.9rem;margin-bottom:1rem;">Enter any combination of search parameters and click Search. SPECTRE generates links to all relevant OSINT tools.</p>
    <h3 style="margin-bottom:0.75rem;">Tips</h3>
    <ul style="color:var(--text-secondary);font-size:0.85rem;margin-left:1rem;">
        <li>Use checkboxes to track visited tools</li>
        <li>Star tools to add to favorites</li>
        <li>Use filters to focus on specific categories</li>
        <li>Export results for documentation</li>
    </ul>`, [{text:'Close',action:'closeModal()'}]);
}
function showShortcutsModal() {
    showModal('Keyboard Shortcuts', `<div style="display:grid;gap:0.5rem;">
        <div style="display:flex;justify-content:space-between;padding:0.5rem;background:var(--bg-tertiary);border-radius:6px;">
            <span>Search</span><code style="background:var(--bg-elevated);padding:0.2rem 0.5rem;border-radius:4px;">Ctrl+Enter</code>
        </div>
        <div style="display:flex;justify-content:space-between;padding:0.5rem;background:var(--bg-tertiary);border-radius:6px;">
            <span>Filter tools</span><code style="background:var(--bg-elevated);padding:0.2rem 0.5rem;border-radius:4px;">Ctrl+K</code>
        </div>
        <div style="display:flex;justify-content:space-between;padding:0.5rem;background:var(--bg-tertiary);border-radius:6px;">
            <span>Go home</span><code style="background:var(--bg-elevated);padding:0.2rem 0.5rem;border-radius:4px;">Alt+H</code>
        </div>
    </div>`, [{text:'Close',action:'closeModal()'}]);
}
function exportData() {
    const data = { favorites, searchHistory, settings: { theme: localStorage.getItem('spectre-theme') } };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'spectre-backup.json';
    a.click();
    toast('Data exported', 'success');
}
function clearData() { if (confirm('Delete ALL data?')) { localStorage.clear(); location.reload(); } }

// ============================================
// TOAST
// ============================================
function toast(msg, type = 'info') {
    const c = document.getElementById('toastContainer');
    const t = document.createElement('div');
    t.className = `toast ${type}`;
    t.innerHTML = `<span>${{success:'‚úì',error:'‚úï',warning:'‚ö†',info:'‚Ñπ'}[type]||'‚Ñπ'}</span><span>${msg}</span>`;
    c.appendChild(t);
    setTimeout(() => { t.style.opacity = '0'; setTimeout(() => t.remove(), 200); }, 3000);
}

// ============================================
// KEYBOARD
// ============================================
document.addEventListener('keydown', e => {
    if (e.ctrlKey && e.key === 'Enter') { e.preventDefault(); runSearch(); }
    if (e.ctrlKey && e.key === 'k') { e.preventDefault(); document.getElementById('toolSearch')?.focus(); }
    if (e.key === 'Escape') { closeModal(); closeDropdowns(); }
    if (e.altKey && e.key === 'h') { e.preventDefault(); goHome(); }
});

// ============================================
// MAIN SEARCH INPUT
// ============================================
document.getElementById('mainSearchInput')?.addEventListener('keypress', e => {
    if (e.key === 'Enter') {
        const v = e.target.value.trim();
        if (v.includes('@')) document.getElementById('qEmail').value = v;
        else if (v.match(/^\d{10,}$/)) document.getElementById('qPhone').value = v;
        else if (v.match(/^[a-z0-9_]+$/i) && !v.includes(' ')) document.getElementById('qUsername').value = v;
        else if (v.includes('.') && !v.includes(' ')) document.getElementById('qDomain').value = v;
        else {
            const p = v.split(/\s+/);
            document.getElementById('qFirst').value = p[0] || '';
            document.getElementById('qLast').value = p.slice(1).join(' ') || '';
        }
        runSearch();
    }
});
document.querySelectorAll('.input-pill input, .quick-field input, .adv-input input').forEach(i => {
    i.addEventListener('input', validateInputs);
    i.addEventListener('keypress', e => { if (e.key === 'Enter') runSearch(); });
});

// ============================================
// INIT
// ============================================
document.addEventListener('DOMContentLoaded', () => {
    initTheme();
    renderHistory();
    renderFavorites();
    let total = 0;
    Object.values(toolsDB).forEach(c => total += c.tools?.length || 0);
    document.getElementById('totalToolCount').textContent = total;
    document.getElementById('totalCount').textContent = total;
    document.getElementById('mainSearchInput')?.focus();
});
</script>
</body>
</html>
